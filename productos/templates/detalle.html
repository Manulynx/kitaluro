{% extends 'base.html' %} 
{% load static %} 
{% block title %}{{producto.nombre}} - Kitaluro{% endblock %} 
{% block description %} {{producto.descripcion_corta}} {% endblock %} 
{% block content %}
<!-- Breadcrumb -->
<div
  class="bg-gray-50 dark:bg-neutral-900/50 border-b border-gray-200 dark:border-neutral-800"
>
  <div class="max-w-7xl mx-auto px-4 py-4">
    <div
      class="flex items-center gap-2 text-sm text-neutral-600 dark:text-gray-400"
    >
      <a
        href="{% url 'home' %}"
        class="hover:text-blue-600 dark:hover:text-blue-400 transition-colors"
        >Inicio</a
      >
      <svg
        class="w-4 h-4"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M9 5l7 7-7 7"
        ></path>
      </svg>
      <a
        href="{% url 'productos:index' %}"
        class="hover:text-blue-600 dark:hover:text-blue-400 transition-colors"
        >Productos</a
      >
      <svg
        class="w-4 h-4"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M9 5l7 7-7 7"
        ></path>
      </svg>
      <span class="text-neutral-900 dark:text-white"
        >{{ producto.nombre }}</span
      >
    </div>
  </div>
</div>

<!-- Product Detail -->
<section class="py-8 px-4 bg-gray-50 dark:bg-neutral-900">
  <div class="max-w-7xl mx-auto">
    <!-- Main Product Section: Image + Title/Price -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
      <!-- Image & Video Gallery -->
      <div class="reveal-left space-y-3 max-w-md">
        <!-- Main Display Area -->
        <div
          id="mainDisplay"
          class="relative bg-white dark:bg-neutral-900 overflow-hidden rounded-xl border border-gray-200 dark:border-neutral-800 shadow-xl dark:shadow-none aspect-square group w-full"
        >
          {% if producto.imagen %}
          <img
            id="mainImage"
            src="{{ producto.imagen.url }}"
            alt="{{ producto.nombre }}"
            class="w-full h-full object-contain p-4"
          />
          <video
            id="mainVideo"
            controls
            class="w-full h-full object-contain hidden"
          ></video>
          {% elif producto.get_main_image %}
          <img
            id="mainImage"
            src="{{ producto.get_main_image.url }}"
            alt="{{ producto.nombre }}"
            class="w-full h-full object-contain p-4"
          />
          <video
            id="mainVideo"
            controls
            class="w-full h-full object-contain hidden"
          ></video>
          {% elif producto.videos_galeria.first %}
          <video
            id="mainVideo"
            src="{{ producto.videos_galeria.first.video.url }}"
            controls
            class="w-full h-full object-contain"
          ></video>
          <img
            id="mainImage"
            src="{% static 'img/placeholder-product.jpg' %}"
            alt="{{ producto.nombre }}"
            class="w-full h-full object-contain hidden"
          />
          <video
            id="mainVideo"
            controls
            class="w-full h-full object-contain hidden"
          ></video>
          {% else %}
          <img
            id="mainImage"
            src="{% static 'img/placeholder-product.jpg' %}"
            alt="{{ producto.nombre }}"
            class="w-full h-full object-contain"
          />
          <video
            id="mainVideo"
            controls
            class="w-full h-full object-contain hidden"
          ></video>
          {% endif %}

          <!-- Navigation Buttons -->
          <button
            id="gallery-prev"
            class="absolute left-2 top-1/2 -translate-y-1/2 bg-black/30 hover:bg-black/50 text-white p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity z-10"
            onclick="prevMedia()"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 19l-7-7 7-7"
              ></path>
            </svg>
          </button>
          <button
            id="gallery-next"
            class="absolute right-2 top-1/2 -translate-y-1/2 bg-black/30 hover:bg-black/50 text-white p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity z-10"
            onclick="nextMedia()"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5l7 7-7 7"
              ></path>
            </svg>
          </button>
        </div>

        <!-- Thumbnails Gallery - Horizontal Scroll -->
        <div class="relative w-full">
          <div
            id="thumbnailGallery"
            class="flex gap-2 sm:gap-3 overflow-x-auto hide-scrollbar pb-2 scroll-smooth"
            style="scroll-snap-type: x mandatory"
          >
            <!-- Imagen principal -->
            {% if producto.imagen or producto.get_main_image %}
            <button
              class="thumbnail-btn flex-shrink-0 bg-white dark:bg-neutral-900 rounded-lg overflow-hidden aspect-square border-2 border-blue-600 dark:border-blue-400 shadow-lg dark:shadow-none w-16 sm:w-20 md:w-24"
              style="scroll-snap-align: start"
              onclick="showImage('{{ producto.imagen.url|default:producto.get_main_image.url }}')"
            >
              <img
                src="{{ producto.imagen.url|default:producto.get_main_image.url }}"
                alt="{{ producto.nombre }}"
                class="w-full h-full object-cover"
              />
            </button>
            {% endif %}

            <!-- Imágenes de la galería -->
            {% for imagen in producto.imagenes_galeria.all %}
            <button
              class="thumbnail-btn flex-shrink-0 bg-white dark:bg-neutral-900 rounded-lg overflow-hidden aspect-square border-2 border-gray-300 dark:border-transparent hover:border-blue-400 dark:hover:border-blue-400/50 transition-all shadow-md dark:shadow-none w-16 sm:w-20 md:w-24"
              style="scroll-snap-align: start"
              onclick="showImage('{{ imagen.image.url }}')"
            >
              <img
                src="{{ imagen.image.url }}"
                alt="{{ imagen.alt_text|default:producto.nombre }}"
                class="w-full h-full object-cover"
              />
            </button>
            {% endfor %}

            <!-- Videos de la galería -->
            {% for video in producto.videos_galeria.all %}
            <button
              class="thumbnail-btn flex-shrink-0 bg-white dark:bg-neutral-900 rounded-lg overflow-hidden aspect-square border-2 border-gray-300 dark:border-transparent hover:border-blue-400 dark:hover:border-blue-400/50 transition-all shadow-md dark:shadow-none relative w-16 sm:w-20 md:w-24"
              style="scroll-snap-align: start"
              onclick="showVideo('{{ video.video.url }}', '{{ video.title|default:producto.nombre }}')"
            >
              <div
                class="w-full h-full bg-gray-800 flex items-center justify-center"
              >
                <svg
                  class="w-8 sm:w-10 md:w-12 h-8 sm:h-10 md:h-12 text-white"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    d="M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"
                  />
                </svg>
              </div>
              {% if video.title %}
              <div
                class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-70 text-white text-xs p-1 truncate"
              >
                {{ video.title }}
              </div>
              {% endif %}
            </button>
            {% endfor %}

            <!-- Video principal si existe -->
            {% if producto.video %}
            <button
              class="thumbnail-btn flex-shrink-0 bg-white dark:bg-neutral-900 rounded-lg overflow-hidden aspect-square border-2 border-gray-300 dark:border-transparent hover:border-blue-400 dark:hover:border-blue-400/50 transition-all shadow-md dark:shadow-none relative w-16 sm:w-20 md:w-24"
              style="scroll-snap-align: start"
              onclick="showVideo('{{ producto.video.url }}', '{{ producto.nombre }}')"
            >
              <div
                class="w-full h-full bg-gray-800 flex items-center justify-center"
              >
                <svg
                  class="w-8 sm:w-10 md:w-12 h-8 sm:h-10 md:h-12 text-white"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    d="M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"
                  />
                </svg>
              </div>
              <div
                class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-70 text-white text-xs p-1 truncate"
              >
                Video Principal
              </div>
            </button>
            {% endif %}
          </div>

          <!-- Indicador de scroll -->
          <div class="mt-2 flex justify-center gap-1" id="scrollIndicator">
            <!-- Generado dinámicamente con JavaScript -->
          </div>
        </div>
      </div>

      <!-- Product Info - Title, Price & Short Description -->
      <div class="reveal-right space-y-4" data-delay="200">
        <!-- Badge & Category -->
        <div class="flex items-center gap-3">
          {% if producto.en_oferta %}
          <span class="badge-offer shadow-lg">Rebaja</span>
          {% elif producto.destacado %}
          <span class="badge-offer shadow-lg">Destacado</span>
          {% endif %} 
          {% if producto.marca or producto.categoria %}
          <span class="text-blue-600 dark:text-blue-400 text-sm font-semibold"
            >{{ producto.marca.nombre|default:producto.categoria.nombre }}</span
          >
          {% endif %}
        </div>

        <!-- Title -->
        <h1
          class="text-3xl sm:text-4xl lg:text-5xl font-serif text-neutral-900 dark:text-white drop-shadow-lg dark:drop-shadow-[0_0_40px_rgba(255,255,255,0.1)]"
        >
          {{ producto.nombre }}
        </h1>

        <!-- Price - Destacado -->
        <div class="flex flex-wrap items-baseline gap-3">
          {% if producto.tiene_descuento %}
          <span
            class="text-4xl sm:text-5xl font-bold text-neutral-900 dark:text-white"
            >${{ producto.precio_oferta }}</span
          >
          <span
            class="text-2xl text-gray-500 dark:text-gray-400 line-through"
            >${{ producto.precio }}</span
          >
          {% if producto.porcentaje_descuento %}
          <span class="badge-offer shadow-lg"
            >-{{ producto.porcentaje_descuento }}%</span
          >
          {% endif %} 
          {% else %}
          <span
            class="text-4xl sm:text-5xl font-bold text-neutral-900 dark:text-white"
            >${{ producto.precio_final }}</span
          >
          {% endif %}
        </div>

        <!-- Short Description -->
        <p class="text-neutral-700 dark:text-gray-300 text-base leading-relaxed">
          {{producto.descripcion_corta|default:producto.descripcion|truncatewords:30}}
        </p>

        <!-- Especificaciones Técnicas -->
        <div
          class="bg-white dark:bg-neutral-900/50 border border-gray-200 dark:border-neutral-800 rounded-xl p-4 shadow-lg dark:shadow-none"
        >
          <h3 class="text-base font-bold text-neutral-900 dark:text-white mb-3">
            Especificaciones Técnicas
          </h3>
          <div class="space-y-2">
            {% if producto.dimensiones %}
            <div class="flex justify-between py-1.5 border-b border-gray-200 dark:border-neutral-700">
              <span class="text-neutral-600 dark:text-gray-400 text-sm">Dimensiones</span>
              <span class="text-neutral-900 dark:text-white font-semibold text-sm">{{ producto.dimensiones }}</span>
            </div>
            {% endif %}
            {% if producto.peso %}
            <div class="flex justify-between py-1.5 border-b border-gray-200 dark:border-neutral-700">
              <span class="text-neutral-600 dark:text-gray-400 text-sm">Peso</span>
              <span class="text-neutral-900 dark:text-white font-semibold text-sm">{{ producto.peso }} kg</span>
            </div>
            {% endif %}
            {% if producto.origen %}
            <div class="flex justify-between py-1.5 border-b border-gray-200 dark:border-neutral-700">
              <span class="text-neutral-600 dark:text-gray-400 text-sm">País de Origen</span>
              <span class="text-neutral-900 dark:text-white font-semibold text-sm">{{ producto.origen }}</span>
            </div>
            {% endif %}
            {% if producto.marca %}
            <div class="flex justify-between py-1.5 border-b border-gray-200 dark:border-neutral-700">
              <span class="text-neutral-600 dark:text-gray-400 text-sm">Marca</span>
              <span class="text-neutral-900 dark:text-white font-semibold text-sm">{{ producto.marca.nombre }}</span>
            </div>
            {% endif %}
            {% if producto.categoria %}
            <div class="flex justify-between py-1.5 border-b border-gray-200 dark:border-neutral-700">
              <span class="text-neutral-600 dark:text-gray-400 text-sm">Categoría</span>
              <span class="text-neutral-900 dark:text-white font-semibold text-sm">{{ producto.categoria.nombre }}</span>
            </div>
            {% endif %}
            {% if producto.subcategoria %}
            <div class="flex justify-between py-1.5 border-b border-gray-200 dark:border-neutral-700">
              <span class="text-neutral-600 dark:text-gray-400 text-sm">Subcategoría</span>
              <span class="text-neutral-900 dark:text-white font-semibold text-sm">{{ producto.subcategoria.nombre }}</span>
            </div>
            {% endif %}
            {% if producto.proveedor %}
            <div class="flex justify-between py-1.5 border-b border-gray-200 dark:border-neutral-700">
              <span class="text-neutral-600 dark:text-gray-400 text-sm">Proveedor</span>
              <span class="text-neutral-900 dark:text-white font-semibold text-sm">{{ producto.proveedor.nombre }}</span>
            </div>
            {% endif %}
            {% if producto.estatus %}
            <div class="flex justify-between py-1.5 border-b border-gray-200 dark:border-neutral-700">
              <span class="text-neutral-600 dark:text-gray-400 text-sm">Estado</span>
              <span class="text-neutral-900 dark:text-white font-semibold text-sm">{{ producto.estatus.nombre }}</span>
            </div>
            {% endif %}
            
            {% if not producto.dimensiones and not producto.peso and not producto.origen and not producto.marca and not producto.categoria and not producto.subcategoria and not producto.proveedor and not producto.estatus %}
            <p class="text-neutral-600 dark:text-gray-400 text-sm py-2">
              No hay especificaciones técnicas disponibles.
            </p>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Detailed Information Section -->
    <div class="reveal space-y-4" data-delay="400">

        <!-- Descripción Completa -->
        {% if producto.descripcion %}
        <div
          class="bg-white dark:bg-neutral-900/50 border border-gray-200 dark:border-neutral-800 rounded-xl p-5 shadow-lg dark:shadow-none"
        >
          <h3 class="text-lg font-bold text-neutral-900 dark:text-white mb-3">
            Descripción Completa
          </h3>
          <div class="text-neutral-700 dark:text-gray-300 leading-relaxed text-sm">
            {{ producto.descripcion|linebreaks }}
          </div>
        </div>
        {% endif %}

        <!-- Garantía -->
        {% if producto.garantia %}
        <div
          class="bg-white dark:bg-neutral-900/50 border border-gray-200 dark:border-neutral-800 rounded-xl p-5 shadow-lg dark:shadow-none"
        >
          <h3
            class="text-lg font-bold text-neutral-900 dark:text-white mb-3 flex items-center gap-2"
          >
            <svg
              class="w-5 h-5 text-green-600 dark:text-green-400"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"
              />
            </svg>
            Garantía
          </h3>
          <div class="text-neutral-700 dark:text-gray-300 leading-relaxed text-sm">
            {{ producto.garantia|linebreaks }}
          </div>
        </div>
        {% endif %}

        <!-- Shipping Info -->
      </div>
    </div>

    <!-- Related Products Section -->
    {% if productos_relacionados %}
    <section class="mt-16 sm:mt-20 lg:mt-24">
      <div class="text-center mb-8 sm:mb-12">
        <h2
          class="reveal font-serif text-3xl sm:text-4xl lg:text-5xl font-bold text-neutral-900 dark:text-white mb-3 sm:mb-4 drop-shadow-sm dark:drop-shadow-[0_0_40px_rgba(255,255,255,0.1)]"
        >
          También Te Puede Interesar
        </h2>
        <p
          class="reveal text-neutral-600 dark:text-neutral-400 text-base sm:text-lg tracking-wide"
          data-delay="150"
        >
          Productos de la misma categoría
        </p>
      </div>

      <div class="relative overflow-hidden -mx-4 sm:mx-0">
        <div
          id="related-carousel"
          class="flex overflow-x-scroll snap-x snap-mandatory hide-scrollbar gap-4 sm:gap-6 pb-4 px-4 sm:px-0"
          style="scroll-padding: 0 1rem"
        >
        {% for prod in productos_relacionados %}
        <a
          href="{% url 'productos:detalle' prod.slug %}"
          class="snap-start flex-shrink-0 w-[280px] sm:w-[320px] group flex flex-col overflow-hidden rounded-xl cursor-pointer bg-white dark:bg-neutral-900/50 shadow-xl dark:shadow-none border border-gray-200 dark:border-neutral-800/50 hover:shadow-2xl dark:hover:shadow-[0_0_30px_rgba(59,130,246,0.2)] transition-all duration-500 hover:scale-[1.02]"
        >
          <!-- Image Section -->
          <div
            class="relative h-[200px] sm:h-[240px] flex-shrink-0 overflow-hidden bg-gray-100 dark:bg-neutral-800"
          >
            {% if prod.imagen %}
            <img
              src="{{ prod.imagen.url }}"
              alt="{{ prod.nombre }}"
              class="w-full h-full object-contain transition-transform duration-500 group-hover:scale-105"
              style="
                image-rendering: -webkit-optimize-contrast;
                image-rendering: crisp-edges;
              "
              loading="lazy"
            />
            {% elif prod.get_main_image %}
            <img
              src="{{ prod.get_main_image.url }}"
              alt="{{ prod.nombre }}"
              class="w-full h-full object-contain transition-transform duration-500 group-hover:scale-105"
              style="
                image-rendering: -webkit-optimize-contrast;
                image-rendering: crisp-edges;
              "
              loading="lazy"
            />
            {% else %}
            <img
              src="{% static 'img/placeholder-product.jpg' %}"
              alt="{{ prod.nombre }}"
              class="w-full h-full object-contain transition-transform duration-500 group-hover:scale-105"
              style="
                image-rendering: -webkit-optimize-contrast;
                image-rendering: crisp-edges;
              "
              loading="lazy"
            />
            {% endif %}

            <!-- Badge -->
            {% if prod.en_oferta or prod.destacado %}
            <div class="absolute top-3 right-3 z-10">
              {% if prod.en_oferta %}
              <span class="badge-offer shadow-lg text-xs">
                {% if prod.porcentaje_descuento %}-{{ prod.porcentaje_descuento }}% OFF{% else %}Rebaja{% endif %}
              </span>
              {% elif prod.destacado %}
              <span class="badge-offer bg-amber-500 shadow-lg text-xs">Destacado</span>
              {% endif %}
            </div>
            {% endif %}
          </div>

          <!-- Content Section -->
          <div class="flex-1 p-3 sm:p-4 bg-white dark:bg-neutral-900 flex flex-col">
            <div class="flex-1 mb-2">
              {% if prod.categoria or prod.marca %}
              <div class="mb-1">
                <span
                  class="text-blue-500 dark:text-blue-400 text-[10px] sm:text-xs font-medium uppercase tracking-wide"
                >
                  {{ prod.marca.nombre|default:prod.categoria.nombre }}
                </span>
              </div>
              {% endif %}

              <h3
                class="text-sm sm:text-base font-bold mb-1 text-neutral-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-all duration-500 line-clamp-2"
              >
                {{ prod.nombre }}
              </h3>

              {% if prod.descripcion_corta %}
              <p
                class="text-neutral-600 dark:text-neutral-400 text-[10px] sm:text-xs leading-relaxed line-clamp-2"
              >
                {{ prod.descripcion_corta }}
              </p>
              {% endif %}
            </div>

            <!-- Price -->
            <div class="pt-2 border-t border-gray-100 dark:border-neutral-800">
              {% if prod.tiene_descuento %}
              <div class="flex items-baseline gap-1.5 flex-wrap">
                <span
                  class="text-base sm:text-lg font-bold text-neutral-900 dark:text-white"
                  >${{ prod.precio_oferta }}</span
                >
                <span
                  class="text-[10px] sm:text-xs text-neutral-500 dark:text-neutral-500 line-through"
                  >${{ prod.precio }}</span
                >
                <span
                  class="text-neutral-500 dark:text-neutral-500 text-[10px] ml-auto"
                  >USD</span
                >
              </div>
              {% else %}
              <div class="flex items-baseline justify-between">
                <span
                  class="text-base sm:text-lg font-bold text-neutral-900 dark:text-white"
                  >${{ prod.precio_final }}</span
                >
                <span class="text-neutral-500 dark:text-neutral-500 text-[10px]"
                  >USD</span
                >
              </div>
              {% endif %}
              {% if prod.stock %}
              <div class="flex items-center gap-1.5 text-xs mt-1.5">
                <div class="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></div>
                <span class="text-neutral-600 dark:text-neutral-400">{{ prod.stock }} disponibles</span>
              </div>
              {% else %}
              <div class="flex items-center gap-1.5 text-xs mt-1.5">
                <div class="w-1.5 h-1.5 bg-red-500 rounded-full"></div>
                <span class="text-neutral-500 dark:text-neutral-500">Agotado</span>
              </div>
              {% endif %}
            </div>
          </div>
        </a>
        {% endfor %}
        </div>
      </div>
    </section>
    {% endif %}
  </div>
</section>
{% endblock %} {% block extra_js %}
<script>
  // ========================================
  // Gallery Media Navigation
  // ========================================
  (function () {
    const mainImage = document.getElementById("mainImage");
    const mainVideo = document.getElementById("mainVideo");
    const thumbnails = document.querySelectorAll(".thumbnail-btn");
    
    // Array para almacenar todos los medios
    let mediaItems = [];
    let currentIndex = 0;

    // Construir array de medios desde los thumbnails
    thumbnails.forEach((thumb, index) => {
      const onclickAttr = thumb.getAttribute("onclick");
      if (onclickAttr) {
        if (onclickAttr.includes("showImage")) {
          const url = onclickAttr.match(/showImage\('([^']+)'\)/)[1];
          mediaItems.push({ type: 'image', url: url, element: thumb });
        } else if (onclickAttr.includes("showVideo")) {
          const matches = onclickAttr.match(/showVideo\('([^']+)',\s*'([^']*)'\)/);
          mediaItems.push({ 
            type: 'video', 
            url: matches[1], 
            title: matches[2],
            element: thumb 
          });
        }
      }
    });

    // Función para mostrar imagen
    window.showImage = function(url) {
      if (mainImage && mainVideo) {
        mainImage.src = url;
        mainImage.classList.remove("hidden");
        mainVideo.classList.add("hidden");
        mainVideo.pause();
        
        // Actualizar índice actual
        currentIndex = mediaItems.findIndex(item => item.type === 'image' && item.url === url);
        updateThumbnailBorders();
      }
    };

    // Función para mostrar video
    window.showVideo = function(url, title) {
      if (mainVideo && mainImage) {
        mainVideo.src = url;
        mainVideo.classList.remove("hidden");
        mainImage.classList.add("hidden");
        
        // Actualizar índice actual
        currentIndex = mediaItems.findIndex(item => item.type === 'video' && item.url === url);
        updateThumbnailBorders();
      }
    };

    // Función para avanzar al siguiente medio
    window.nextMedia = function() {
      if (mediaItems.length === 0) return;
      
      currentIndex = (currentIndex + 1) % mediaItems.length;
      showMedia(currentIndex);
    };

    // Función para retroceder al medio anterior
    window.prevMedia = function() {
      if (mediaItems.length === 0) return;
      
      currentIndex = (currentIndex - 1 + mediaItems.length) % mediaItems.length;
      showMedia(currentIndex);
    };

    // Función auxiliar para mostrar medio por índice
    function showMedia(index) {
      const media = mediaItems[index];
      if (!media) return;

      if (media.type === 'image') {
        showImage(media.url);
      } else if (media.type === 'video') {
        showVideo(media.url, media.title || '');
      }
    }

    // Actualizar bordes de thumbnails
    function updateThumbnailBorders() {
      thumbnails.forEach((thumb, index) => {
        if (index === currentIndex) {
          thumb.classList.remove('border-gray-300', 'dark:border-transparent');
          thumb.classList.add('border-blue-600', 'dark:border-blue-400');
        } else {
          thumb.classList.remove('border-blue-600', 'dark:border-blue-400');
          thumb.classList.add('border-gray-300', 'dark:border-transparent');
        }
      });
    }

    // Inicializar el primer thumbnail como activo
    if (mediaItems.length > 0) {
      updateThumbnailBorders();
    }
  })();

  // ========================================
  // Gallery Scroll Indicator
  // ========================================
  (function () {
    const gallery = document.getElementById("thumbnailGallery");
    const indicator = document.getElementById("scrollIndicator");

    if (gallery && indicator) {
      const items = gallery.children.length;
      const dotsCount = Math.min(items, 10); // Máximo 10 puntos

      // Crear dots
      for (let i = 0; i < dotsCount; i++) {
        const dot = document.createElement("div");
        dot.className =
          "w-2 h-2 rounded-full bg-gray-300 dark:bg-neutral-700 transition-all duration-300";
        if (i === 0)
          dot.classList.add("!bg-blue-600", "dark:!bg-blue-400", "w-4");
        indicator.appendChild(dot);
      }

      // Actualizar dots al hacer scroll
      gallery.addEventListener("scroll", () => {
        const scrollPercentage =
          gallery.scrollLeft / (gallery.scrollWidth - gallery.clientWidth);
        const activeDot = Math.round(scrollPercentage * (dotsCount - 1));

        Array.from(indicator.children).forEach((dot, index) => {
          if (index === activeDot) {
            dot.classList.add("!bg-blue-600", "dark:!bg-blue-400", "w-4");
          } else {
            dot.classList.remove("!bg-blue-600", "dark:!bg-blue-400", "w-4");
          }
        });
      });
    }
  })();
</script>
{% endblock %}
