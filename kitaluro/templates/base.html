{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Compras seguras con pagos internacionales. Visa, Mastercard, PayPal. Env√≠os garantizados.">
    <title>{% block title %}Kitaluro{% endblock %}</title>
    
    <!-- Preload critical CSS inline para primera carga -->
    <style>
        /* CSS cr√≠tico inline para primera carga */
        body{font-family:Arial,Helvetica,sans-serif;font-size:16px;line-height:1.5;color:#111;background:#fff;margin:0;padding:0}
        .header{background:#0066cc;color:white;position:sticky;top:0;z-index:1000;box-shadow:0 2px 4px rgba(0,0,0,0.1)}
        .header-content{display:flex;justify-content:space-between;align-items:center;padding:16px;max-width:1200px;margin:0 auto}
        .logo{font-size:20px;font-weight:bold;color:white;text-decoration:none}
        .container{max-width:1200px;margin:0 auto;padding:0 16px}
    </style>
    
    <!-- Cargar CSS completo de forma as√≠ncrona -->
    <link rel="preload" href="{% static 'css/styles.css' %}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="{% static 'css/styles.css' %}"></noscript>
</head>
<body>

    <header class="header">
        <div class="container header-content">
            <div class="logo-section">
                <!-- Bot√≥n explorar (m√≥vil) -->
                <button class="categories-toggle" aria-label="Explorar" id="categories-toggle">
                    Explorar
                </button>
                <a href="{% url 'home' %}" class="logo" aria-label="Ir al inicio">KITALURO</a>
            </div>
            
            <div class="header-actions">
                <!-- Carrito (solo m√≥vil) -->
                <!-- <a href="#" class="cart-icon mobile-only" aria-label="Carrito de compras">
                    üõí
                    <span class="cart-count" id="cart-count">0</span>
                </a> -->
                
                <!-- Login (solo m√≥vil) -->
                <a href="#" class="login-btn mobile-only" aria-label="Iniciar sesi√≥n">
                    Login
                </a>
            </div>
            
            <!-- Navegaci√≥n principal (solo desktop) -->
            <nav class="header-nav desktop-only" id="header-nav">
                <a href="{% url 'home' %}" class="header-nav-item">Inicio</a>
                <a href="{% url 'productos:index' %}" class="header-nav-item">Productos</a>
                <a href="#" class="header-nav-item">Contacto</a>
                <!-- <a href="#" class="header-nav-item cart-desktop" aria-label="Carrito de compras">
                    üõí
                    <span class="cart-count" id="cart-count-desktop">0</span>
                </a> -->
                <a href="#" class="header-nav-item login-desktop">Login</a>
            </nav>

        </div>
    </header>

    <!-- Barra de categor√≠as horizontal (desktop) -->
    <nav class="horizontal-nav desktop-only" id="horizontal-nav">
        <div class="container">
            <div class="categories-horizontal">
                    <div class="category-dropdown" data-category="ferramenta">
                        <button class="category-btn">üî® Ferramenta</button>
                        <div class="dropdown-content">
                            <a href="#">Malleus</a>
                            <a href="#">Clavis</a>
                            <a href="#">Lima</a>
                            <a href="#">Securis</a>
                        </div>
                    </div>
                    
                    <div class="category-dropdown" data-category="instrumenta">
                        <button class="category-btn">üîß Instrumenta</button>
                        <div class="dropdown-content">
                            <a href="#">Torquens</a>
                            <a href="#">Pliers</a>
                            <a href="#">Mensura</a>
                            <a href="#">Nivellum</a>
                        </div>
                    </div>
                    
                    <div class="category-dropdown" data-category="mechanica">
                        <button class="category-btn">‚öôÔ∏è Mechanica</button>
                        <div class="dropdown-content">
                            <a href="#">Rota</a>
                            <a href="#">Axis</a>
                            <a href="#">Cochlea</a>
                            <a href="#">Clavus</a>
                        </div>
                    </div>
                    
                    <div class="category-dropdown" data-category="constructio">
                        <button class="category-btn">ü™ö Constructio</button>
                        <div class="dropdown-content">
                            <a href="#">Serra</a>
                            <a href="#">Terebratio</a>
                            <a href="#">Planum</a>
                            <a href="#">Circinus</a>
                        </div>
                    </div>
            </div>
        </div>
    </nav>

    <!-- Sidebar m√≥vil -->
    <aside class="sidebar mobile-only" id="categories-sidebar">
        <div class="sidebar-overlay" id="sidebar-overlay"></div>
        <div class="sidebar-content">
            <div class="sidebar-header">
                <h3>Explorar</h3>
                <button class="sidebar-close" id="sidebar-close">√ó</button>
            </div>
            
            <div class="sidebar-body">
                <!-- Navegaci√≥n principal -->
                <div class="sidebar-section navigation-section">
                    <h4>Navegaci√≥n</h4>
                    <a href="{% url 'home' %}" class="nav-option">
                        üè† Inicio
                    </a>
                    <a href="{% url 'productos:index' %}" class="nav-option">
                        üì¶ Productos
                    </a>
                    <a href="#" class="nav-option">
                        üìû Contacto
                    </a>
                </div>
                
                <!-- Categor√≠as principales -->
                <div class="sidebar-section categories-section">
                    <h4>Categor√≠as de Productos</h4>
                    <div class="category-group">
                        <button class="category-toggle" data-category="ferramenta">
                            üî® Ferramenta
                            <span class="toggle-arrow">‚ñº</span>
                        </button>
                        <div class="subcategory-list" id="ferramenta">
                            <a href="#" class="subcategory-item">Malleus</a>
                            <a href="#" class="subcategory-item">Clavis</a>
                            <a href="#" class="subcategory-item">Lima</a>
                            <a href="#" class="subcategory-item">Securis</a>
                        </div>
                    </div>
                    
                    <div class="category-group">
                        <button class="category-toggle" data-category="instrumenta">
                            üîß Instrumenta
                            <span class="toggle-arrow">‚ñº</span>
                        </button>
                        <div class="subcategory-list" id="instrumenta">
                            <a href="#" class="subcategory-item">Torquens</a>
                            <a href="#" class="subcategory-item">Pliers</a>
                            <a href="#" class="subcategory-item">Mensura</a>
                            <a href="#" class="subcategory-item">Nivellum</a>
                        </div>
                    </div>
                    
                    <div class="category-group">
                        <button class="category-toggle" data-category="mechanica">
                            üî® Mechanica
                            <span class="toggle-arrow">‚ñº</span>
                        </button>
                        <div class="subcategory-list" id="mechanica">
                            <a href="#" class="subcategory-item">Rota</a>
                            <a href="#" class="subcategory-item">Axis</a>
                            <a href="#" class="subcategory-item">Cochlea</a>
                            <a href="#" class="subcategory-item">Clavus</a>
                        </div>
                    </div>
                    
                    <div class="category-group">
                        <button class="category-toggle" data-category="constructio">
                            ü™ö Constructio
                            <span class="toggle-arrow">‚ñº</span>
                        </button>
                        <div class="subcategory-list" id="constructio">
                            <a href="#" class="subcategory-item">Serra</a>
                            <a href="#" class="subcategory-item">Terebratio</a>
                            <a href="#" class="subcategory-item">Planum</a>
                            <a href="#" class="subcategory-item">Circinus</a>
                        </div>
                    </div>
                </div>
                
                <!-- Opciones adicionales -->
                <div class="sidebar-section sidebar-options">
                    <a href="#" class="option-item user-only" style="display: none;">üìã Historial de Pedidos</a>
                    <a href="#" class="option-item">‚ùì FAQ / Ayuda</a>
                    <a href="#" class="option-item">üìû Contacto</a>
                </div>
            </div>
        </div>
    </aside>

    <main class="main-content container">
        {% block content %}{% endblock %}
    </main>

    <footer class="footer">
        <div class="container footer-content">
            <!-- Enlaces de confianza -->
            <div class="footer-trust">
                <a href="#" class="trust-link">‚ùì FAQ</a>
                <a href="#" class="trust-link">üìû Contacto</a>
            </div>
            
            <!-- M√©todos de pago -->
            <div class="payment-methods">
                <span class="payment-title">Pagos internacionales seguros:</span>
                <span class="payment-icon">Visa</span>
                <span class="payment-icon">Mastercard</span>
                <span class="payment-icon">PayPal</span>
                <span class="ssl-badge">üîí SSL</span>
            </div>
            
            <!-- Contacto de soporte -->
            <div class="support-contact">
                <a href="https://wa.me/5353000000" class="whatsapp-support">
                    üì± Soporte WhatsApp
                </a>
            </div>
            
            <div class="footer-copy">
                <p>M&C Dev Studio {{ now|date:"Y" }}. Compras seguras en Cuba.</p>
            </div>
        </div>
    </footer>

    <script>
        // Funcionalidad ultraligera del header
        document.addEventListener('DOMContentLoaded', function() {
            const body = document.body;
            
            // Sidebar de categor√≠as (diferido)
            const categoriesToggle = document.getElementById('categories-toggle');
            const sidebar = document.getElementById('categories-sidebar');
            const sidebarOverlay = document.getElementById('sidebar-overlay');
            const sidebarClose = document.getElementById('sidebar-close');
            
            if (categoriesToggle && sidebar) {
                // Abrir sidebar
                categoriesToggle.addEventListener('click', function() {
                    sidebar.classList.add('sidebar-open');
                    body.classList.add('sidebar-active');
                });
                
                // Cerrar sidebar
                function closeSidebar() {
                    sidebar.classList.remove('sidebar-open');
                    body.classList.remove('sidebar-active');
                }
                
                if (sidebarClose) sidebarClose.addEventListener('click', closeSidebar);
                if (sidebarOverlay) sidebarOverlay.addEventListener('click', closeSidebar);
                
                // Expandir/colapsar categor√≠as
                const categoryToggles = document.querySelectorAll('.category-toggle');
                categoryToggles.forEach(toggle => {
                    toggle.addEventListener('click', function() {
                        const categoryId = this.getAttribute('data-category');
                        const subcategoryList = document.getElementById(categoryId);
                        const arrow = this.querySelector('.toggle-arrow');
                        
                        if (subcategoryList) {
                            const isOpen = subcategoryList.classList.contains('open');
                            
                            // Cerrar todas las categor√≠as primero
                            document.querySelectorAll('.subcategory-list.open').forEach(list => {
                                list.classList.remove('open');
                            });
                            document.querySelectorAll('.toggle-arrow').forEach(arr => {
                                arr.textContent = '‚ñº';
                            });
                            
                            // Abrir la actual si estaba cerrada
                            if (!isOpen) {
                                subcategoryList.classList.add('open');
                                arrow.textContent = '‚ñ≤';
                            }
                        }
                    });
                });
                
                // Cerrar sidebar al seleccionar subcategor√≠a
                const subcategoryItems = document.querySelectorAll('.subcategory-item');
                subcategoryItems.forEach(item => {
                    item.addEventListener('click', function() {
                        closeSidebar();
                    });
                });
            }

            // Actualizar contador del carrito (simulado)
            // function updateCartCount() {
            //     const cartCountMobile = document.getElementById('cart-count');
            //     const cartCountDesktop = document.getElementById('cart-count-desktop');
            //     const count = localStorage.getItem('cartCount') || '0';
            //     
            //     if (cartCountMobile) {
            //         cartCountMobile.textContent = count;
            //         cartCountMobile.style.display = count === '0' ? 'none' : 'inline';
            //     }
            //     
            //     if (cartCountDesktop) {
            //         cartCountDesktop.textContent = count;
            //         cartCountDesktop.style.display = count === '0' ? 'none' : 'inline';
            //     }
            // }
            // 
            // updateCartCount();
        });
    </script>

    <!-- Sidebar JavaScript - Carga diferida para no bloquear contenido cr√≠tico -->
    <script defer>
        // Funcionalidad del sidebar (diferida)
        document.addEventListener('DOMContentLoaded', function() {
            // Solo cargar si los elementos existen
            const categoriesToggle = document.getElementById('categories-toggle');
            const sidebar = document.getElementById('categories-sidebar');
            const sidebarOverlay = document.getElementById('sidebar-overlay');
            const sidebarClose = document.getElementById('sidebar-close');
            const body = document.body;
            
            if (!categoriesToggle || !sidebar) return;
            
            // Funciones del sidebar
            function openSidebar() {
                // Solo funcionar en m√≥vil
                if (window.innerWidth < 1024) {
                    sidebar.classList.add('sidebar-open');
                    body.classList.add('sidebar-active');
                }
            }
            
            function closeSidebar() {
                sidebar.classList.remove('sidebar-open');
                body.classList.remove('sidebar-active');
            }
            
            // Event listeners con verificaci√≥n de viewport
            categoriesToggle.addEventListener('click', function() {
                if (window.innerWidth < 1024) {
                    openSidebar();
                }
            });
            if (sidebarClose) sidebarClose.addEventListener('click', closeSidebar);
            if (sidebarOverlay) sidebarOverlay.addEventListener('click', closeSidebar);
            
            // Cerrar con ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && sidebar.classList.contains('sidebar-open')) {
                    closeSidebar();
                }
            });
            
            // Expandir/colapsar categor√≠as (solo en m√≥vil)
            const categoryToggles = document.querySelectorAll('.category-toggle');
            categoryToggles.forEach(toggle => {
                toggle.addEventListener('click', function() {
                    if (window.innerWidth >= 1024) return; // Solo en m√≥vil
                    
                    const categoryId = this.getAttribute('data-category');
                    const subcategoryList = document.getElementById(categoryId);
                    const arrow = this.querySelector('.toggle-arrow');
                    
                    if (subcategoryList && arrow) {
                        const isOpen = subcategoryList.classList.contains('open');
                        
                        // Cerrar todas las categor√≠as
                        document.querySelectorAll('.subcategory-list.open').forEach(list => {
                            list.classList.remove('open');
                        });
                        document.querySelectorAll('.toggle-arrow').forEach(arr => {
                            arr.textContent = '‚ñº';
                        });
                        
                        // Abrir la actual si estaba cerrada
                        if (!isOpen) {
                            subcategoryList.classList.add('open');
                            arrow.textContent = '‚ñ≤';
                        }
                    }
                });
            });
            
            // Cerrar sidebar al seleccionar subcategor√≠a (solo m√≥vil)
            const subcategoryItems = document.querySelectorAll('.subcategory-item');
            subcategoryItems.forEach(item => {
                item.addEventListener('click', function() {
                    if (window.innerWidth < 1024) {
                        closeSidebar();
                    }
                });
            });
            
            // Mostrar/ocultar historial para usuarios logueados
            // Este ser√≠a reemplazado por l√≥gica de Django cuando se implemente autenticaci√≥n
            const userOnlyElements = document.querySelectorAll('.user-only');
            const isUserLoggedIn = false; // Placeholder - conectar con Django auth
            
            if (isUserLoggedIn) {
                userOnlyElements.forEach(el => el.style.display = 'block');
            }
            
            // Detectar cambios de viewport y cerrar sidebar si cambia a desktop
            window.addEventListener('resize', function() {
                if (window.innerWidth >= 1024) {
                    closeSidebar();
                    // Forzar ocultaci√≥n del sidebar en desktop
                    if (sidebar) {
                        sidebar.style.display = 'none';
                        sidebar.style.visibility = 'hidden';
                        sidebar.style.opacity = '0';
                        sidebar.style.left = '-100%';
                    }
                } else {
                    // Restaurar visibilidad en m√≥vil
                    if (sidebar) {
                        sidebar.style.display = '';
                        sidebar.style.visibility = '';
                        sidebar.style.opacity = '';
                        sidebar.style.left = '';
                    }
                }
            });
            
            // Verificar viewport inicial
            if (window.innerWidth >= 1024 && sidebar) {
                sidebar.style.display = 'none';
                sidebar.style.visibility = 'hidden';
                sidebar.style.opacity = '0';
                sidebar.style.left = '-100%';
            }

            // Manejo de dropdowns horizontales (desktop)
            const categoryDropdowns = document.querySelectorAll('.category-dropdown');
            let activeDropdown = null;
            
            categoryDropdowns.forEach(dropdown => {
                const btn = dropdown.querySelector('.category-btn');
                const content = dropdown.querySelector('.dropdown-content');
                
                if (btn && content) {
                    // Mostrar dropdown al pasar el mouse
                    dropdown.addEventListener('mouseenter', function() {
                        if (window.innerWidth >= 1024) {
                            activeDropdown = dropdown;
                        }
                    });
                    
                    // Ocultar dropdown al salir
                    dropdown.addEventListener('mouseleave', function() {
                        if (window.innerWidth >= 1024) {
                            activeDropdown = null;
                        }
                    });
                    
                    // Cerrar dropdowns al hacer clic fuera
                    document.addEventListener('click', function(e) {
                        if (window.innerWidth >= 1024 && !dropdown.contains(e.target)) {
                            // Los dropdowns se manejan con CSS hover
                        }
                    });
                }
            });
        });
    </script>

</body>
</html>
