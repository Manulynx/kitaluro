{% extends 'base.html' %} {% load static %} {% block title %}Kitaluro | The
Future of Home{% endblock %} {% block content %}

<!-- ========================================================================== -->
<!-- HERO BANNER - VIDEO COMPLETO SIN RECORTE -->
<!-- ========================================================================== -->
<section class="lux-hero-banner">
  <div class="lux-hero-media reveal">
    <video
      id="heroVideo"
      class="lux-hero-video"
      autoplay
      muted
      loop
      playsinline
      preload="none"
      poster="{% static 'img/hero-poster.jpg' %}"
      aria-label="Video promocional de la colecci√≥n Kitaluro"
    >
      <source src="{% static 'video/videowebm.webm' %}" type="video/webm" />
      <source src="{% static 'video/video.mp4' %}" type="video/mp4" />
      <img src="{% static 'img/hero-poster.jpg' %}" alt="Colecci√≥n Kitaluro" />
    </video>

    <!-- Capa de texto solo para escritorio/tablet -->
    <div class="lux-hero-overlay">
      <div class="lux-hero-content">
        <p class="lux-hero-kicker">Colecci√≥n 2025</p>
        <h1 class="lux-hero-title">KITALURO</h1>
        <p class="lux-hero-subtitle">Redefiniendo el lujo.</p>
        <div class="lux-hero-actions">
          <a href="{% url 'productos:index' %}" class="btn-crimson"
            >Explorar Colecci√≥n</a
          >
        </div>
      </div>
    </div>
  </div>

  <!-- Bloque de texto independiente solo para m√≥viles -->
  <div class="lux-hero-mobile-copy reveal">
    <p class="lux-hero-mobile-kicker">Colecci√≥n 2025</p>
    <h1 class="lux-hero-mobile-title">KITALURO</h1>
    <p class="lux-hero-mobile-subtitle">Redefiniendo el lujo.</p>
    <div class="lux-hero-mobile-actions">
      <a href="{% url 'productos:index' %}" class="btn-crimson"
        >Explorar Colecci√≥n</a
      >
    </div>
  </div>
</section>
<section
  id="products"
  class="py-12 sm:py-16 md:py-20 lg:py-24 px-4 sm:px-6 lg:px-8 bg-gray-50 dark:bg-neutral-900"
>
  <div class="max-w-7xl mx-auto">
    <div class="text-center mb-8 sm:mb-12 lg:mb-16">
      <h2
        class="reveal font-serif text-4xl sm:text-5xl lg:text-6xl font-bold text-neutral-900 dark:text-white mb-3 sm:mb-4 drop-shadow-sm dark:drop-shadow-[0_0_40px_rgba(255,255,255,0.1)]"
      >
        Destacados
      </h2>
      <p
        class="reveal text-neutral-600 dark:text-neutral-400 text-base sm:text-lg tracking-wide"
        data-delay="150"
      >
        Selecci√≥n Premium
      </p>
    </div>

    <div
      class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 lg:gap-8"
      data-stagger="150"
    >
      {% for producto in productos %} {% if producto.destacado %}
      <div
        class="reveal-scale group product-card h-[420px] sm:h-[480px] lg:h-[500px] bg-white dark:bg-neutral-900/50 rounded-xl sm:rounded-2xl overflow-hidden shadow-xl dark:shadow-none border border-gray-200 dark:border-neutral-800/50 hover:shadow-2xl dark:hover:shadow-[0_0_30px_rgba(59,130,246,0.2)] transition-all duration-500 hover:scale-[1.02]"
      >
        <a
          href="{% url 'productos:detalle' producto.slug %}"
          class="relative h-full block"
        >
          {% if producto.imagen %}
          <img
            src="{{ producto.imagen.url }}"
            alt="{{ producto.nombre }}"
            class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
          />
          {% elif producto.get_main_image %}
          <img
            src="{{ producto.get_main_image.url }}"
            alt="{{ producto.nombre }}"
            class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
          />
          {% else %}
          <img
            src="{% static 'img/placeholder-product.jpg' %}"
            alt="{{ producto.nombre }}"
            class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
          />
          {% endif %} {% if producto.en_oferta or producto.destacado %}
          <div class="absolute top-3 sm:top-4 right-3 sm:right-4 z-10">
            {% if producto.en_oferta %}
            <span class="badge-offer shadow-lg text-xs sm:text-sm">
              {% if producto.porcentaje_descuento %}-{{
              producto.porcentaje_descuento }}% OFF{% else %}Oferta{% endif %}
            </span>
            {% elif producto.destacado %}
            <span class="badge-offer bg-amber-500 shadow-lg text-xs sm:text-sm"
              >Destacado</span
            >
            {% endif %}
          </div>
          {% endif %}

          <div
            class="absolute inset-0 bg-gradient-to-t from-neutral-900/95 via-neutral-900/50 to-transparent dark:from-black/90 dark:via-black/30 dark:to-transparent"
          ></div>

          <div
            class="absolute bottom-0 left-0 right-0 p-4 sm:p-6 lg:p-8 space-y-2 sm:space-y-3 lg:space-y-4"
          >
            {% if producto.categoria or producto.marca %}
            <span
              class="inline-block text-blue-400 dark:text-blue-400 text-[10px] sm:text-xs font-medium tracking-wider sm:tracking-widest uppercase"
            >
              {{ producto.categoria.nombre|default_if_none:"" }} {{
              producto.marca.nombre|default_if_none:"" }}
            </span>
            {% endif %}

            <h3
              class="font-serif text-xl sm:text-2xl lg:text-3xl font-bold text-white group-hover:text-amber-300 dark:group-hover:text-amber-200 transition-all duration-500 drop-shadow-lg line-clamp-2"
            >
              {{ producto.nombre }}
            </h3>

            {% if producto.descripcion_corta %}
            <p
              class="text-gray-100 dark:text-neutral-300 text-xs sm:text-sm opacity-90 line-clamp-2 hidden sm:block"
            >
              {{ producto.descripcion_corta }}
            </p>
            {% endif %}

            <div class="flex items-baseline gap-1.5 sm:gap-2">
              {% if producto.tiene_descuento %}
              <span class="text-lg sm:text-xl lg:text-2xl font-bold text-white"
                >${{ producto.precio_oferta }}</span
              >
              <span
                class="text-xs sm:text-sm text-gray-300 dark:text-gray-400 line-through"
                >${{ producto.precio }}</span
              >
              {% else %}
              <span class="text-lg sm:text-xl lg:text-2xl font-bold text-white"
                >${{ producto.precio_final }}</span
              >
              {% endif %}
              <span
                class="text-gray-300 dark:text-gray-400 text-[10px] sm:text-xs"
                >USD</span
              >
            </div>

            {% comment %}
            <div class="product-cta">
              <button
                class="btn-crimson w-full mt-1 sm:mt-2 shadow-lg text-sm sm:text-base py-2.5 sm:py-3"
              >
                Ver Detalles
              </button>
            </div>
            {% endcomment %}
          </div>
        </a>
      </div>
      {% endif %} {% empty %}
      <div class="col-span-full text-center py-16">
        <div
          class="bg-white dark:bg-neutral-900/50 border border-gray-200 dark:border-neutral-800 rounded-2xl p-12 max-w-2xl mx-auto shadow-xl dark:shadow-none"
        >
          <svg
            class="w-24 h-24 mx-auto mb-6 text-gray-400 dark:text-gray-600"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"
            ></path>
          </svg>
          <h3 class="text-2xl font-bold text-neutral-900 dark:text-white mb-4">
            No hay productos disponibles
          </h3>
          <p class="text-neutral-600 dark:text-gray-400 mb-8">
            Agrega productos desde el panel de administraci√≥n.
          </p>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</section>
<section
  class="reveal py-12 sm:py-16 md:py-20 lg:py-24 px-0 bg-gray-100 dark:bg-neutral-950 overflow-hidden"
>
  <div class="max-w-7xl mx-auto">
    {% if productos %}
    <div class="text-center mb-8 sm:mb-10 lg:mb-12 px-4 sm:px-6">
      <h2
        class="font-serif text-4xl sm:text-5xl lg:text-6xl font-bold text-neutral-900 dark:text-white mb-3 sm:mb-4 drop-shadow-sm dark:drop-shadow-[0_0_40px_rgba(255,255,255,0.1)]"
      >
        Otros Productos
      </h2>
      
    </div>
    {% endif %}

    <div class="relative">
      <div
        class="absolute left-0 top-0 bottom-0 w-16 bg-gradient-to-r from-gray-100 dark:from-neutral-950 to-transparent z-10 pointer-events-none hidden md:block"
      ></div>

      <div
        class="absolute right-0 top-0 bottom-0 w-16 bg-gradient-to-l from-gray-100 dark:from-neutral-950 to-transparent z-10 pointer-events-none hidden md:block"
      ></div>

      <div
        id="product-carousel"
        class="flex overflow-x-scroll snap-x snap-mandatory hide-scrollbar gap-4 sm:gap-5 lg:gap-6 px-4 sm:px-6 lg:px-8 pb-4"
        style="scroll-padding: 0 1rem"
      >
        {% for producto in productos %} {% if not producto.destacado %}
        <div
          class="snap-start snap-always flex-shrink-0 w-[85vw] sm:w-[70vw] md:w-[45vw] lg:w-[350px] xl:w-[380px] group"
        >
          <a
            href="{% url 'productos:detalle' producto.slug %}"
            class="block bg-white dark:bg-neutral-900 rounded-xl sm:rounded-2xl overflow-hidden shadow-xl dark:shadow-2xl hover:shadow-2xl dark:hover:shadow-[0_0_40px_rgba(59,130,246,0.3)] transition-all duration-500 hover:scale-[1.02] border border-gray-200 dark:border-neutral-800 hover:border-blue-500/30 dark:hover:border-blue-500/30 h-full flex flex-col"
          >
            <div
              class="relative h-[280px] sm:h-[320px] md:h-[280px] lg:h-[300px] overflow-hidden bg-gray-200 dark:bg-neutral-800 flex-shrink-0"
            >
              {% if producto.imagen %}
              <img
                src="{{ producto.imagen.url }}"
                alt="{{ producto.nombre }}"
                class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700"
                loading="lazy"
              />
              {% elif producto.get_main_image %}
              <img
                src="{{ producto.get_main_image.url }}"
                alt="{{ producto.nombre }}"
                class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700"
                loading="lazy"
              />
              {% else %}
              <img
                src="{% static 'img/placeholder-product.jpg' %}"
                alt="{{ producto.nombre }}"
                class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700"
                loading="lazy"
              />
              {% endif %}

              <div
                class="absolute inset-0 bg-gradient-to-t from-neutral-900 via-neutral-900/40 to-transparent"
              ></div>

              {% if producto.en_oferta or producto.destacado %}
              <div class="absolute top-3 sm:top-4 right-3 sm:right-4 z-10">
                {% if producto.en_oferta %}
                <span class="badge-offer shadow-lg text-xs sm:text-sm">
                  {% if producto.porcentaje_descuento %}-{{
                  producto.porcentaje_descuento }}%{% else %}Oferta{% endif %}
                </span>
                {% elif producto.destacado %}
                <span
                  class="badge-offer bg-blue-600 shadow-lg text-xs sm:text-sm"
                  >Premium</span
                >
                {% endif %}
              </div>
              {% endif %} {% if producto.marca or producto.categoria %}
              <div
                class="absolute top-3 sm:top-4 left-3 sm:left-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300"
              >
                <span
                  class="text-blue-400 text-[10px] sm:text-xs uppercase tracking-wider sm:tracking-widest font-semibold"
                >
                  {{ producto.marca.nombre|default:producto.categoria.nombre }}
                </span>
              </div>
              {% endif %}
            </div>

            <div
              class="p-4 sm:p-5 lg:p-5 space-y-2 sm:space-y-2.5 bg-white dark:bg-neutral-900 flex-grow flex flex-col"
            >
              <h3
                class="font-serif text-base sm:text-lg md:text-xl font-bold text-neutral-900 dark:text-white group-hover:text-blue-500 dark:group-hover:text-blue-400 transition-colors duration-300 line-clamp-2 leading-tight"
              >
                {{ producto.nombre }}
              </h3>

              <div class="flex items-baseline gap-2">
                {% if producto.tiene_descuento %}
                <span
                  class="text-lg sm:text-xl font-bold text-neutral-900 dark:text-white"
                >
                  ${{ producto.precio_oferta }}
                </span>
                <span
                  class="text-sm text-neutral-500 dark:text-neutral-500 line-through"
                >
                  ${{ producto.precio }}
                </span>
                {% else %}
                <span
                  class="text-lg sm:text-xl font-bold text-neutral-900 dark:text-white"
                >
                  ${{ producto.precio_final }}
                </span>
                {% endif %}
                <span class="text-neutral-500 dark:text-neutral-500 text-xs"
                  >USD</span
                >
              </div>

              {% comment %}
              <button
                class="btn-crimson w-full shadow-lg transform group-hover:shadow-xl transition-all duration-300 text-sm py-2.5 mt-auto"
              >
                Ver Detalles
              </button>
              {% endcomment %} {% if producto.stock %}
              <div class="flex items-center gap-1.5 text-xs">
                <div
                  class="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"
                ></div>
                <span class="text-neutral-600 dark:text-neutral-400">
                  {{ producto.stock }} disponibles
                </span>
              </div>
              {% else %}
              <div class="flex items-center gap-1.5 text-xs">
                <div class="w-1.5 h-1.5 bg-red-500 rounded-full"></div>
                <span class="text-neutral-500 dark:text-neutral-500">
                  Agotado
                </span>
              </div>
              {% endif %}
            </div>
          </a>
        </div>
        {% endif %} {% endfor %} {% if not productos %}
        <div
          class="snap-start flex-shrink-0 w-[85vw] sm:w-[70vw] md:w-[45vw] lg:w-[32%]"
        >
          <div
            class="bg-white dark:bg-neutral-900 rounded-xl sm:rounded-2xl p-8 sm:p-12 text-center border border-gray-200 dark:border-neutral-800"
          >
            <svg
              class="w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-3 sm:mb-4 text-gray-400 dark:text-neutral-700"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"
              ></path>
            </svg>
            <h3
              class="text-lg sm:text-xl font-bold text-neutral-900 dark:text-white mb-2"
            >
              No hay productos
            </h3>
            <p
              class="text-neutral-600 dark:text-neutral-500 text-sm sm:text-base"
            >
              Agrega productos desde el panel de administraci√≥n
            </p>
          </div>
        </div>
        {% endif %}
      </div>

      <!-- Controles de navegaci√≥n -->
      <!-- Bot√≥n Anterior: pegado al margen izquierdo -->
      <button
        id="carousel-prev"
        type="button"
        class="pointer-events-auto absolute inset-y-1/2 -translate-y-1/2 left-2 sm:left-4 z-20 w-8 h-8 sm:w-9 sm:h-9 lg:w-16 lg:h-16 flex items-center justify-center rounded-full bg-black/30 dark:bg-white/5 hover:bg-black/50 dark:hover:bg-white/10 text-white border border-blue-500/40 hover:border-blue-400 shadow-[0_0_15px_rgba(37,99,235,0.45)] transition-colors duration-200"
        aria-label="Anterior"
      >
        <svg
          class="w-4 h-4"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.8"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M15 19l-7-7 7-7"
          />
        </svg>
      </button>

      <!-- Bot√≥n Play / Pause: centrado abajo -->
      <div
        class="pointer-events-none absolute bottom-4 left-1/2 -translate-x-1/2 z-20"
      >
        <button
          id="carousel-playpause"
          type="button"
          class="pointer-events-auto w-8 h-8 sm:w-9 sm:h-9 lg:w-16 lg:h-16 flex items-center justify-center rounded-full bg-black/40 dark:bg-white/10 hover:bg-black/60 dark:hover:bg-white/20 text-white border border-blue-500/40 hover:border-blue-400 shadow-[0_0_15px_rgba(37,99,235,0.45)] transition-colors duration-200"
          aria-label="Pausar carrusel"
        >
          <!-- √çcono Play -->
          <svg
            data-icon="play"
            class="w-4 h-4 hidden"
            viewBox="0 0 24 24"
            fill="currentColor"
          >
            <path d="M8 5v14l11-7z" />
          </svg>
          <!-- √çcono Pause -->
          <svg
            data-icon="pause"
            class="w-4 h-4"
            viewBox="0 0 24 24"
            fill="currentColor"
          >
            <path d="M7 5h4v14H7zM13 5h4v14h-4z" />
          </svg>
        </button>
      </div>

      <!-- Bot√≥n Siguiente: pegado al margen derecho -->
      <button
        id="carousel-next"
        type="button"
        class="pointer-events-auto absolute inset-y-1/2 -translate-y-1/2 right-2 sm:right-4 z-20 w-8 h-8 sm:w-9 sm:h-9 lg:w-16 lg:h-16 flex items-center justify-center rounded-full bg-black/30 dark:bg-white/5 hover:bg-black/50 dark:hover:bg-white/10 text-white border border-blue-500/40 hover:border-blue-400 shadow-[0_0_15px_rgba(37,99,235,0.45)] transition-colors duration-200"
        aria-label="Siguiente"
      >
        <svg
          class="w-4 h-4"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.8"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M9 5l7 7-7 7"
          />
        </svg>
      </button>

      
    </div>
  </div>
  {% endblock %} {% block extra_js %}
  <style>
    /* ======================================== */
    /* ANIMACIONES PREMIUM PARA CARRUSEL */
    /* ======================================== */
    @keyframes ripple {
      0% {
        transform: scale(0);
        opacity: 1;
      }
      100% {
        transform: scale(2);
        opacity: 0;
      }
    }

    @keyframes luxuryGlow {
      0%,
      100% {
        box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
      }
      50% {
        box-shadow: 0 0 40px rgba(59, 130, 246, 0.6),
          0 0 60px rgba(59, 130, 246, 0.3);
      }
    }

    @keyframes subtleFloat {
      0%,
      100% {
        transform: translateY(0px);
      }
      50% {
        transform: translateY(-2px);
      }
    }

    /* Mejoras para los botones de control */
    #carousel-prev,
    #carousel-next,
    #carousel-playpause {
      transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      backdrop-filter: blur(10px) saturate(120%);
      /* Mantener posici√≥n absoluta original - NO cambiar position */
      overflow: visible; /* Permitir efectos fuera del bot√≥n */
    }

    #carousel-prev:hover,
    #carousel-next:hover,
    #carousel-playpause:hover {
      animation: luxuryGlow 2s ease-in-out infinite;
    }

    /* Efectos de paralaje para las tarjetas del carrusel */
    .product-card {
      will-change: transform, opacity, filter;
      backface-visibility: hidden;
      transform-style: preserve-3d;
    }

    .product-card img {
      will-change: transform, filter;
      backface-visibility: hidden;
    }

    /* Indicador de carga m√°s elegante */
    .carousel-loading {
      position: relative;
    }

    .carousel-loading::after {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: 40px;
      height: 40px;
      border: 3px solid rgba(59, 130, 246, 0.3);
      border-radius: 50%;
      border-top-color: rgba(59, 130, 246, 0.8);
      animation: spin 1s ease-in-out infinite;
      transform: translate(-50%, -50%);
    }

    @keyframes spin {
      to {
        transform: translate(-50%, -50%) rotate(360deg);
      }
    }

    /* Mejoras para efectos de hover en productos */
    .product-card a:hover {
      transform: translateY(-8px) scale(1.02);
      transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
    }

    .product-card a:hover img {
      filter: contrast(1.1) saturate(1.2) brightness(1.05);
      transform: scale(1.05);
      transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
    }
  </style>
  <script>
    // ========================================
    // AUTOPLAY CAROUSEL - Controles + Auto-Scroll Inteligente
    // ========================================
    (function () {
      const carousel = document.getElementById("product-carousel");
      const prevBtn = document.getElementById("carousel-prev");
      const nextBtn = document.getElementById("carousel-next");
      const playPauseBtn = document.getElementById("carousel-playpause");

      if (!carousel || !prevBtn || !nextBtn || !playPauseBtn) {
        return;
      }

      const items = carousel.querySelectorAll(".snap-start");
      let currentIndex = 0;

      function updateVisibleItem() {
        if (!items.length) return;

        // Animaci√≥n premium con efectos de profundidad y glassmorphism
        items.forEach((item, index) => {
          const card = item.querySelector("a");
          const image = item.querySelector("img");

          if (index === currentIndex) {
            // === ITEM ACTIVO: Entrada con efecto cinematogr√°fico ===
            item.style.display = "block";
            item.style.zIndex = "10";

            // Estado inicial (fuera de pantalla con efectos dram√°ticos)
            item.style.opacity = "0";
            item.style.transform =
              "translateX(80px) translateY(20px) scale(0.85) rotateY(15deg)";
            item.style.filter = "blur(8px) brightness(0.7)";

            if (card) {
              card.style.boxShadow =
                "0 0 0 rgba(59, 130, 246, 0), 0 0 60px rgba(0, 0, 0, 0.1)";
              card.style.backdropFilter = "blur(0px) saturate(100%)";
            }

            if (image) {
              image.style.transform = "scale(1.1)";
              image.style.filter = "contrast(0.8) saturate(0.9)";
            }

            // Forzar reflow para preparar la animaci√≥n
            void item.offsetWidth;

            // Transici√≥n premium con curvas de b√©zier sofisticadas
            item.style.transition = "all 1.2s cubic-bezier(0.16, 1, 0.3, 1)";
            if (card) {
              card.style.transition =
                "all 1.2s cubic-bezier(0.16, 1, 0.3, 1), box-shadow 1.5s cubic-bezier(0.16, 1, 0.3, 1)";
            }
            if (image) {
              image.style.transition = "all 1.4s cubic-bezier(0.16, 1, 0.3, 1)";
            }

            // Estado final (completamente visible con efectos premium)
            requestAnimationFrame(() => {
              item.style.opacity = "1";
              item.style.transform =
                "translateX(0) translateY(0) scale(1) rotateY(0deg)";
              item.style.filter = "blur(0px) brightness(1)";

              if (card) {
                card.style.boxShadow =
                  "0 25px 50px rgba(59, 130, 246, 0.15), 0 8px 25px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(59, 130, 246, 0.1)";
                card.style.backdropFilter = "blur(20px) saturate(120%)";
              }

              if (image) {
                image.style.transform = "scale(1)";
                image.style.filter = "contrast(1.05) saturate(1.1)";
              }
            });

            // Efecto de brillo sutil despu√©s de la entrada
            setTimeout(() => {
              if (card && index === currentIndex) {
                card.style.boxShadow =
                  "0 30px 60px rgba(59, 130, 246, 0.2), 0 12px 30px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(59, 130, 246, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1)";
              }
            }, 3000);
          } else {
            // === ITEMS INACTIVOS: Salida con desvanecimiento elegante ===
            item.style.zIndex = "1";

            // Transici√≥n de salida m√°s r√°pida pero elegante
            item.style.transition = "all 0.8s cubic-bezier(0.4, 0, 0.6, 1)";
            if (card) {
              card.style.transition = "all 0.8s cubic-bezier(0.4, 0, 0.6, 1)";
            }
            if (image) {
              image.style.transition = "all 0.9s cubic-bezier(0.4, 0, 0.6, 1)";
            }

            // Estado de salida con efectos de profundidad
            item.style.opacity = "0";
            item.style.transform =
              "translateX(-60px) translateY(-10px) scale(0.9) rotateY(-10deg)";
            item.style.filter = "blur(4px) brightness(0.8)";

            if (card) {
              card.style.boxShadow = "0 5px 15px rgba(0, 0, 0, 0.1)";
              card.style.backdropFilter = "blur(5px) saturate(80%)";
            }

            if (image) {
              image.style.transform = "scale(0.95)";
              image.style.filter = "contrast(0.9) saturate(0.8)";
            }

            // Ocultar completamente con un delay apropiado
            setTimeout(() => {
              if (index !== currentIndex) {
                item.style.display = "none";
                item.style.zIndex = "0";
              }
            }, 800);
          }
        });

        // Configuraci√≥n del contenedor con efectos mejorados
        carousel.style.justifyContent = "center";
        carousel.style.overflowX = "hidden";
        carousel.style.display = "flex";
        carousel.style.perspective = "1000px";
        carousel.style.transformStyle = "preserve-3d";
      }

      // Inicializar vista
      updateVisibleItem();

      const AUTO_PLAY_DELAY = 2500;
      let autoPlayInterval = null;
      let isPlaying = true;

      function updatePlayPauseUI() {
        const playIcon = playPauseBtn.querySelector('[data-icon="play"]');
        const pauseIcon = playPauseBtn.querySelector('[data-icon="pause"]');
        if (!playIcon || !pauseIcon) return;

        if (isPlaying) {
          playIcon.classList.add("hidden");
          pauseIcon.classList.remove("hidden");
          playPauseBtn.setAttribute("aria-label", "Pausar carrusel");
        } else {
          playIcon.classList.remove("hidden");
          pauseIcon.classList.add("hidden");
          playPauseBtn.setAttribute("aria-label", "Reproducir carrusel");
        }
      }

      function pauseAutoPlay() {
        if (autoPlayInterval) {
          clearInterval(autoPlayInterval);
          autoPlayInterval = null;
        }
        if (isPlaying) {
          isPlaying = false;
          updatePlayPauseUI();
        }
      }

      function startAutoPlay() {
        if (autoPlayInterval) {
          clearInterval(autoPlayInterval);
        }
        isPlaying = true;
        updatePlayPauseUI();

        autoPlayInterval = setInterval(() => {
          goNext(true);
        }, AUTO_PLAY_DELAY);
      }

      function handleUserInteraction() {
        // Pausar autoplay cuando el usuario interact√∫a
        pauseAutoPlay();
        console.log("‚è∏Ô∏è Autoplay pausado por interacci√≥n del usuario");
      }

      function goNext(fromAuto = false) {
        if (!items.length) return;
        currentIndex = (currentIndex - 1 + items.length) % items.length;
        updateVisibleItem();

        if (!fromAuto) {
          handleUserInteraction();
        }
      }

      function goPrev() {
        if (!items.length) return;
        currentIndex = (currentIndex + 1) % items.length;
        updateVisibleItem();
        handleUserInteraction();
      }

      // Corregido: Anterior -> goPrev, Siguiente -> goNext
      // Efectos premium para botones de control
      function addButtonEffects(button) {
        button.addEventListener("mouseenter", () => {
          button.style.transform = "scale(1.1)";
          button.style.boxShadow =
            "0 0 25px rgba(59, 130, 246, 0.6), 0 0 50px rgba(59, 130, 246, 0.4)";
          button.style.backdropFilter = "blur(15px) saturate(150%)";
        });

        button.addEventListener("mouseleave", () => {
          button.style.transform = "scale(1)";
          button.style.boxShadow = "0 0 15px rgba(37, 99, 235, 0.45)";
          button.style.backdropFilter = "blur(10px) saturate(120%)";
        });

        button.addEventListener("mousedown", () => {
          button.style.transform = "scale(0.95)";
        });

        button.addEventListener("mouseup", () => {
          button.style.transform = "scale(1.1)";
        });
      }

      // Aplicar efectos a todos los botones
      [prevBtn, nextBtn, playPauseBtn].forEach(addButtonEffects);

      prevBtn.addEventListener("click", (e) => {
        e.preventDefault();
        // Efecto de ondas en el bot√≥n (ajustado para posici√≥n absoluta)
        const ripple = document.createElement("div");
        ripple.style.cssText = `
          position: absolute; width: 100%; height: 100%; border-radius: 50%;
          background: radial-gradient(circle, rgba(59,130,246,0.6) 0%, transparent 70%);
          animation: ripple 0.6s ease-out; pointer-events: none; top: 0; left: 0; z-index: -1;
        `;
        prevBtn.style.position = "relative"; // Temporalmente para el ripple
        prevBtn.appendChild(ripple);
        setTimeout(() => {
          ripple.remove();
          prevBtn.style.position = ""; // Restaurar posici√≥n original
        }, 600);

        handleUserInteraction();
        goPrev();
      });

      nextBtn.addEventListener("click", (e) => {
        e.preventDefault();
        // Efecto de ondas en el bot√≥n (ajustado para posici√≥n absoluta)
        const ripple = document.createElement("div");
        ripple.style.cssText = `
          position: absolute; width: 100%; height: 100%; border-radius: 50%;
          background: radial-gradient(circle, rgba(59,130,246,0.6) 0%, transparent 70%);
          animation: ripple 0.6s ease-out; pointer-events: none; top: 0; left: 0; z-index: -1;
        `;
        nextBtn.style.position = "relative"; // Temporalmente para el ripple
        nextBtn.appendChild(ripple);
        setTimeout(() => {
          ripple.remove();
          nextBtn.style.position = ""; // Restaurar posici√≥n original
        }, 600);

        handleUserInteraction();
        goNext();
      });

      playPauseBtn.addEventListener("click", (e) => {
        e.preventDefault();
        // Efecto de rotaci√≥n suave en el √≠cono
        const icons = playPauseBtn.querySelectorAll("svg");
        icons.forEach((icon) => {
          icon.style.transform = "rotate(180deg)";
          setTimeout(() => (icon.style.transform = "rotate(0deg)"), 300);
        });

        if (isPlaying) {
          pauseAutoPlay();
        } else {
          startAutoPlay();
        }
      });

      // Gestos t√°ctiles mejorados con animaciones premium
      let touchStartX = 0;
      let touchEndX = 0;
      let touchStartTime = 0;
      let isDragging = false;
      let dragOffset = 0;

      carousel.addEventListener(
        "touchstart",
        (e) => {
          touchStartX = e.changedTouches[0].screenX;
          touchStartTime = Date.now();
          isDragging = true;

          // A√±adir clase para efectos durante el drag
          carousel.classList.add("dragging");
        },
        { passive: true }
      );

      carousel.addEventListener(
        "touchmove",
        (e) => {
          if (!isDragging) return;

          touchEndX = e.changedTouches[0].screenX;
          dragOffset = touchEndX - touchStartX;

          // Efecto de arrastre visual premium
          const activeItem = items[currentIndex];
          if (activeItem) {
            const dragPercent = Math.min(
              Math.abs(dragOffset) / window.innerWidth,
              0.3
            );
            const rotateY = (dragOffset / window.innerWidth) * 15;
            const scale = 1 - dragPercent * 0.1;

            activeItem.style.transform = `translateX(${
              dragOffset * 0.5
            }px) rotateY(${rotateY}deg) scale(${scale})`;
            activeItem.style.filter = `blur(${dragPercent * 3}px)`;
            activeItem.style.opacity = 1 - dragPercent * 0.3;
          }
        },
        { passive: true }
      );

      carousel.addEventListener(
        "touchend",
        (e) => {
          if (!isDragging) return;

          touchEndX = e.changedTouches[0].screenX;
          const touchDuration = Date.now() - touchStartTime;
          const velocity = Math.abs(dragOffset) / touchDuration;

          isDragging = false;
          dragOffset = 0;
          carousel.classList.remove("dragging");

          // Resetear el item activo con animaci√≥n suave
          const activeItem = items[currentIndex];
          if (activeItem) {
            activeItem.style.transition =
              "all 0.4s cubic-bezier(0.16, 1, 0.3, 1)";
            activeItem.style.transform = "translateX(0) rotateY(0deg) scale(1)";
            activeItem.style.filter = "blur(0px)";
            activeItem.style.opacity = "1";
          }

          handleSwipe(velocity);
        },
        { passive: true }
      );

      function handleSwipe(velocity = 0) {
        const threshold = velocity > 0.3 ? 30 : 50; // Threshold din√°mico basado en velocidad
        const swipeDistance = touchEndX - touchStartX;

        if (Math.abs(swipeDistance) > threshold) {
          // A√±adir efectos de feedback haptic si est√° disponible
          if (navigator.vibrate) {
            navigator.vibrate(50);
          }

          if (swipeDistance < 0) {
            handleUserInteraction();
            goNext(); // Swipe Left -> Next
          } else {
            handleUserInteraction();
            goPrev(); // Swipe Right -> Prev
          }
        }
      }

      // Iniciar autoplay
      startAutoPlay();

      window.addEventListener("beforeunload", () => {
        if (autoPlayInterval) {
          clearInterval(autoPlayInterval);
        }
      });
    })();

    // ========================================
    // VIDEO DEBUG
    // ========================================
    (function () {
      const video = document.getElementById("heroVideo");

      if (video) {
        console.log("üé¨ VIDEO DEBUG - Informaci√≥n del video:");
        console.log("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ");

        // Detectar errores de carga
        video.addEventListener(
          "error",
          function (e) {
            console.error("‚ùå ERROR AL CARGAR EL VIDEO");
            console.error(
              "C√≥digo de error:",
              video.error ? video.error.code : "Desconocido"
            );
            console.error(
              "Mensaje:",
              video.error ? video.error.message : "Sin mensaje"
            );

            // Intentar obtener la fuente que fall√≥
            const sources = video.querySelectorAll("source");
            sources.forEach((source, index) => {
              console.error(`Fuente ${index + 1}:`, source.src);
              console.error(`Tipo:`, source.type);
            });
          },
          true
        );

        // Cuando el video se carga correctamente
        video.addEventListener("loadeddata", function () {
          console.log("‚úÖ VIDEO CARGADO EXITOSAMENTE");
          console.log("Duraci√≥n:", video.duration, "segundos");
          console.log("Dimensiones:", video.videoWidth, "x", video.videoHeight);
        });

        // Cuando el video empieza a reproducirse
        video.addEventListener("playing", function () {
          console.log("‚ñ∂Ô∏è VIDEO REPRODUCI√âNDOSE");
        });

        // Mostrar todas las fuentes de video
        const sources = video.querySelectorAll("source");
        console.log("üìÅ Fuentes de video configuradas:");
        sources.forEach((source, index) => {
          console.log(`  ${index + 1}. ${source.type}:`);
          console.log(`     ${source.src}`);

          // Verificar si la URL es accesible
          fetch(source.src, { method: "HEAD" })
            .then((response) => {
              if (response.ok) {
                console.log(`     ‚úÖ Archivo accesible (${response.status})`);
              } else {
                console.error(
                  `     ‚ùå Error ${response.status}: Archivo no encontrado`
                );
              }
            })
            .catch((err) => {
              console.error(`     ‚ùå Error de red:`, err.message);
            });
        });

        // Mostrar poster
        console.log("üñºÔ∏è Poster:", video.poster);

        // Verificar estado de reproducci√≥n
        setTimeout(() => {
          if (video.paused) {
            console.warn("‚ö†Ô∏è El video est√° PAUSADO");
            console.log("Intentando reproducir manualmente...");

            video
              .play()
              .then(() => console.log("‚úÖ Reproducci√≥n manual exitosa"))
              .catch((err) => console.error("‚ùå Error al reproducir:", err));
          } else {
            console.log("‚úÖ El video se est√° reproduciendo autom√°ticamente");
          }
        }, 1000);

        console.log("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ");
      } else {
        console.error(
          '‚ùå No se encontr√≥ el elemento <video> con id="heroVideo"'
        );
      }
    })();
  </script>
  {% endblock %}
</section>
